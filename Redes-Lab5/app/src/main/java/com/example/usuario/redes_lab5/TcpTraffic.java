package com.example.usuario.redes_lab5;import java.io.BufferedReader;import java.io.BufferedWriter;import java.io.InputStreamReader;import java.io.OutputStreamWriter;import java.io.PrintWriter;import java.net.DatagramPacket;import java.net.DatagramSocket;import java.net.InetAddress;import java.net.Socket;/** * Created by Usuario on 12/03/2016. */public class TcpTraffic implements Runnable{    private String ip;    private int puerto;    private MainActivity principal;    private Socket socketTCP;    private PrintWriter out;    private BufferedReader in;    public boolean detener;    public TcpTraffic(String ip, int puerto, MainActivity pal)    {        this.ip=ip;        principal=pal;        this.puerto=puerto;        try        {            socketTCP=new Socket(ip,puerto);            out = new PrintWriter(new BufferedWriter(new OutputStreamWriter(socketTCP.getOutputStream())),true);            in = new BufferedReader( new InputStreamReader(socketTCP.getInputStream()));            System.out.println("Socket TCP: Creado");        }        catch(Exception e)        {            System.out.println("Socket TCP: Error al crear: "+e.getMessage());            e.printStackTrace();        }    }    public void enviarMensaje(String mensaje)    {        try        {            out.println(mensaje);            principal.cantidadEnviado++;            System.out.println("TCP-Envío:"+mensaje);            String rta = in.readLine();            System.out.println("TCP-Rta:"+rta);            if(!rta.equals("200 OK"));            {                // Se produjo un error, informar a la principal                principal.cantidadErrores++;            }        }        catch(Exception e)        {            e.printStackTrace();            principal.cantidadErrores++;        }    }    public void cerrarConexion()    {        try        {            out.close();            in.close();            socketTCP.close();        }        catch(Exception e)        {            System.out.println("ERROR CERRANDO EL SOCKET");            e.printStackTrace();        }    }    @Override    public void run()    {        System.out.println("TCP: Envío iniciado");        while(!principal.seguirLeyendo())        {            String mensaje = principal.leerMensaje();            if(mensaje!=null)            {                enviarMensaje(mensaje);                System.out.println("TCP: Mensaje enviado:"+mensaje);            }            try            {                wait(50);            }            catch(Exception e)            {                e.printStackTrace();            }        }        System.out.println("TCP: Fin de envío. Cerrando Socket ...");        cerrarConexion();    }}